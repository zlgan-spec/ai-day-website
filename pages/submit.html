<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提交作品 - AI-Day</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand': '#FF6B2B',
                        'brand-light': '#FF8A4D',
                        'brand-dark': '#E55A1F',
                        'dark-gray': '#1A1A1A',
                        'card-bg': '#2A2A2A'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-black text-white">
    <!-- 顶部导航栏 -->
    <nav class="fixed top-0 left-0 right-0 bg-black/80 backdrop-blur-sm z-50 border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                                    <div class="flex items-center space-x-2">
                    <img src="../assets/images/aftership-icon.png" alt="AfterShip Icon" class="w-8 h-8 object-contain">
                    <span class="text-white text-lg font-semibold">aftership</span>
                </div>
                    <div class="w-px h-6 bg-gray-600"></div>
                    <a href="../" class="text-2xl font-bold text-white">AI-Day</a>
                </div>
                
                <!-- 导航菜单 -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="../" class="text-gray-300 hover:text-white transition-colors">首页</a>
                    <a href="./submit.html" class="text-white px-4 py-2 rounded-lg border border-white">作品提交</a>
                    <a href="./vote.html" class="text-gray-300 hover:text-white transition-colors">我要投票</a>
                </div>
                
                <!-- 用户信息/登录按钮 -->
                <div class="flex items-center space-x-4">
                    <div id="user-info" class="hidden text-sm text-gray-300"></div>
                    <button id="login-btn" data-auth="unauth" class="bg-brand hover:bg-brand-light text-white px-4 py-2 rounded-lg transition-colors">
                        使用 Google 登录
                    </button>
                    <button id="logout-btn" data-auth="required" class="hidden text-gray-300 hover:text-white transition-colors">
                        退出登录
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <main class="pt-28 pb-16 relative">
        <!-- 背景装饰 -->
        <div class="absolute top-0 right-0 w-96 h-96 opacity-20 animate-pulse">
            <div class="w-full h-full bg-gradient-to-br from-brand to-brand-light rounded-full blur-3xl"></div>
        </div>
        
        <!-- 左侧装饰 -->
        <div class="absolute top-20 left-0 w-64 h-64 opacity-10 animate-bounce">
            <div class="w-full h-full bg-gradient-to-bl from-brand to-brand-dark rounded-full blur-2xl"></div>
        </div>
        
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <!-- 页面标题 -->
            <div class="text-center mb-16">
                <h1 class="text-4xl font-bold text-white mb-6">提交你的 AI 作品</h1>
                <p class="text-xl text-gray-300">分享你的创意，让更多人看到你的想法</p>
            </div>

            <!-- 登录提示（未登录用户） -->
            <div id="login-prompt" data-auth="unauth" class="bg-black/50 rounded-2xl p-8 text-center mb-8 border border-[#D6D6D6]/20">
                <div class="w-20 h-20 bg-brand rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-semibold text-white mb-4">需要登录才能提交作品</h2>
                <p class="text-gray-400 mb-6">请使用 Google 账号登录后，即可提交你的 AI 作品</p>
                <button id="prompt-login-btn" class="bg-brand hover:bg-brand-light text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors">
                    立即登录
                </button>
            </div>

            <!-- 作品提交表单（已登录用户） -->
            <div id="submit-form" data-auth="required" class="hidden">
                <div class="bg-black/50 rounded-2xl p-8 border border-[#D6D6D6]/20">
                    <form id="submission-form" class="space-y-6">
                        <!-- 作品名称 -->
                        <div>
                            <label for="title" class="block text-sm font-medium text-white mb-3 flex items-center space-x-2">
                                <svg class="w-5 h-5 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                </svg>
                                <span>作品名称</span>
                                <span class="text-red-400">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="title" 
                                name="title" 
                                required
                                class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand focus:border-brand transition-all duration-300 hover:border-gray-600"
                                placeholder="请输入你的作品名称"
                                maxlength="100"
                            >
                        </div>

                        <!-- 作品简介 -->
                        <div>
                            <label for="description" class="block text-sm font-medium text-white mb-3 flex items-center space-x-2">
                                <svg class="w-5 h-5 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span>作品简介</span>
                                <span class="text-red-400">*</span>
                            </label>
                            <textarea 
                                id="description" 
                                name="description" 
                                required
                                rows="6"
                                class="w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand focus:border-brand transition-all duration-300 hover:border-gray-600 resize-none"
                                placeholder="请详细描述你的作品，包括创作理念、技术特点、创新点等..."
                                maxlength="1000"
                            ></textarea>
                            <div class="flex justify-between items-center mt-3">
                                <span class="text-sm text-gray-400 flex items-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span>请详细描述你的作品</span>
                                </span>
                                <span class="text-sm text-gray-400 bg-gray-800/50 px-3 py-1 rounded-full">
                                    <span id="char-count">0</span>/1000
                                </span>
                            </div>
                        </div>

                        <!-- 提交按钮 -->
                        <div class="pt-4">
                            <button 
                                type="submit" 
                                class="w-full bg-gradient-to-r from-brand to-brand-light hover:from-brand-light hover:to-brand text-white py-4 rounded-xl text-lg font-semibold transition-all transform hover:scale-105 hover:shadow-lg hover:shadow-brand/25 flex items-center justify-center space-x-2"
                                id="submit-btn"
                            >
                                <span id="submit-text">提交作品</span>
                                <div id="submit-loading" class="hidden">
                                    <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 提交成功提示 -->
                <div id="success-message" class="hidden bg-green-900/20 border border-green-500/30 rounded-2xl p-8 text-center mt-8">
                    <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-semibold text-white mb-4">作品提交成功！</h2>
                    <p class="text-gray-300 mb-6">你的作品已经成功提交，现在可以去投票页面查看所有作品了</p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button onclick="window.location.href='./vote.html'" class="bg-brand hover:bg-brand-light text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors">
                            查看所有作品
                        </button>
                        <button onclick="resetForm()" class="border-2 border-white text-white hover:bg-white hover:text-black px-6 py-3 rounded-lg text-lg font-semibold transition-colors">
                            继续提交
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部区域 -->
    <footer class="bg-black/50 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-gray-400">&copy; AI-Day. 持续开放的 AI 创意展示平台.</p>
        </div>
    </footer>

    <!-- 加载 JavaScript -->
    <script src="../assets/js/common.js"></script>
    <script src="../assets/js/supabase-client.js"></script>
    <script>
        // 页面特定的 JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // 字符计数
            const description = document.getElementById('description');
            const charCount = document.getElementById('char-count');
            
            description.addEventListener('input', function() {
                charCount.textContent = this.value.length;
            });

            // 登录按钮点击事件
            document.getElementById('login-btn').addEventListener('click', async function() {
                const success = await SupabaseClient.signInWithGoogle();
                if (success) {
                    Common.showMessage('正在跳转到 Google 登录...', 'info');
                }
            });

            // 提示登录按钮点击事件
            document.getElementById('prompt-login-btn').addEventListener('click', async function() {
                const success = await SupabaseClient.signInWithGoogle();
                if (success) {
                    Common.showMessage('正在跳转到 Google 登录...', 'info');
                }
            });
            
            // 退出登录按钮点击事件
            document.getElementById('logout-btn').addEventListener('click', async function() {
                const success = await SupabaseClient.signOut();
                if (success) {
                    Common.showMessage('已成功退出登录', 'success');
                }
            });

            // 表单提交事件
            document.getElementById('submission-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const title = document.getElementById('title').value.trim();
                const description = document.getElementById('description').value.trim();
                
                if (!title || !description) {
                    Common.showMessage('请填写完整的作品信息', 'error');
                    return;
                }

                // 显示加载状态
                setSubmitLoading(true);
                
                try {
                    // 提交作品到数据库
                    const success = await submitSubmission(title, description);
                    
                    if (success) {
                        // 显示成功消息
                        document.getElementById('submit-form').classList.add('hidden');
                        document.getElementById('success-message').classList.remove('hidden');
                    } else {
                        Common.showMessage('提交失败，请重试', 'error');
                    }
                } catch (error) {
                    console.error('提交作品失败:', error);
                    Common.showMessage('提交失败，请重试', 'error');
                } finally {
                    setSubmitLoading(false);
                }
            });
        });

        // 设置提交按钮加载状态
        function setSubmitLoading(loading) {
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const submitLoading = document.getElementById('submit-loading');
            
            if (loading) {
                submitBtn.disabled = true;
                submitText.classList.add('hidden');
                submitLoading.classList.remove('hidden');
            } else {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitLoading.classList.add('hidden');
            }
        }

        // 提交作品到数据库
        async function submitSubmission(title, description) {
            try {
                const { data, error } = await SupabaseClient.client
                    .from('submissions')
                    .insert([
                        {
                            title: title,
                            description: description,
                            user_id: SupabaseClient.getCurrentUser().id
                        }
                    ])
                    .select();

                if (error) throw error;
                
                Common.showMessage('作品提交成功！', 'success');
                return true;
            } catch (error) {
                console.error('提交作品失败:', error);
                Common.showMessage('提交失败：' + error.message, 'error');
                return false;
            }
        }

        // 重置表单
        function resetForm() {
            document.getElementById('submission-form').reset();
            document.getElementById('char-count').textContent = '0';
            document.getElementById('submit-form').classList.remove('hidden');
            document.getElementById('success-message').classList.add('hidden');
        }
    </script>
</body>
</html>
